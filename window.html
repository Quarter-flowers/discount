<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Засніжене Вікно</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cormorant+Garamond:wght@400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <style>
        body {
            background: #0d291e;
            margin: 0;
            overflow: hidden;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        /* The beautiful shop behind the fog */
        #shop-view {
            width: 100%;
            height: 100%;
            /* Pine background with dark overlay for text readability */
            background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6)), url('tulips_bg.png') no-repeat center center;
            background-size: cover;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #d4af37;
            /* Gold text */
            user-select: none;
            text-align: center;
        }

        h1 {
            font-family: 'Cinzel', 'Trajan Pro', serif;
            font-size: 3rem;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
            /* Tighter, more elegant spacing */
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
            text-transform: uppercase;
            font-weight: 600;
        }

        p {
            font-family: 'WensleyDemo', 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #f7f1e3;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.9);
            font-weight: 600;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
            cursor: pointer;
            touch-action: none;
            /* Important for preventing scroll on mobile */
        }

        .instruction-overlay {
            position: absolute;
            top: 60%;
            width: 100%;
            z-index: 20;
            color: rgba(255, 255, 255, 0.9);
            pointer-events: none;
            font-size: 1.1rem;
            text-align: center;
            letter-spacing: 1px;
            font-weight: 300;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* Lead Gen Form Styles */
        .lead-form input {
            background: rgba(0, 0, 0, 0.4);
            /* Darker for Window */
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 12px 20px;
            color: #fff;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            width: 70%;
            margin-bottom: 15px;
            text-align: center;
            outline: none;
            transition: 0.3s;
        }

        .lead-form input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .lead-form input:focus {
            border-color: #d4af37;
            background: rgba(0, 0, 0, 0.6);
        }

        .hidden-offer {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .hidden-offer.visible {
            display: block;
            opacity: 1;
        }
    </style>
</head>

<body>
    <div id="container">
        <!-- The Content Behind -->
        <div id="shop-view">
            <h1>YOUR LAST CHANCE</h1>

            <div id="promoCard" style="width: 100%; max-width: 500px;">
                <!-- FORM -->
                <form class="lead-form" id="emailForm" onsubmit="handleForm(event)">
                    <p style="margin-bottom: 20px; color: #f7f1e3; font-size: 1.2rem;">
                        Залиште контакти, щоб отримати знижку
                    </p>
                    <input type="hidden" name="source" value="Window">
                    <input type="text" name="name" placeholder="Ваше Ім'я" required
                        style="display:block; margin: 0 auto 10px auto;">
                    <input type="text" name="contact" placeholder="Email або Телефон" required
                        style="display:block; margin: 0 auto 15px auto;">

                    <button
                        style="background: transparent; border: 1px solid #d4af37; color: #d4af37; padding: 10px 30px; cursor: pointer; font-family: 'Cinzel'; transition:0.3s;"
                        type="submit">Отримати код</button>
                </form>

                <!-- OFFER -->
                <div class="hidden-offer" id="offerResult"
                    style="text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center;">
                    <div
                        style="border: 1px solid #d4af37; padding: 20px; margin-top: 20px; background: rgba(0,0,0,0.3); max-width: 80%;">
                        <p style="margin: 0; color: #d4af37; font-size: 1.5rem; letter-spacing: 2px;">Ваш код:
                            LASTCHANCE</p>
                        <p style="margin: 5px 0 0 0; font-size: 1rem; opacity: 0.8;">-14% на передзамовлення тюльпанів
                            до 8 березня</p>
                    </div>
                    <button onclick="window.location.href='https://t.me/quarter_flowers_cv?text=LASTCHANCE%20-14%25'"
                        style="background: transparent; border: 1px solid #d4af37; color: #d4af37; padding: 10px 30px; cursor: pointer; font-family: 'Cinzel'; margin-top: 20px; transition:0.3s; width: auto; max-width: 80%;">
                        Написати в Telegram
                    </button>
                </div>
            </div>

            <br>

        </div>

        <div class="instruction-overlay" id="hint">Протри запотіле вікно...</div>

        <!-- The Fog -->
        <canvas id="fogCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('fogCanvas');
        const ctx = canvas.getContext('2d');
        const hint = document.getElementById('hint');
        let isDrawing = false;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            drawFoggyGlass();
        }

        function drawFoggyGlass() {
            // 1. Base Fog Layer (Steamy Grey-White)
            // High opacity so they can't see the code yet, but lighter than solid wall
            ctx.fillStyle = "rgba(230, 235, 240, 0.96)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Condensation Texture (Thousands of tiny droplets)
            for (let i = 0; i < 5000; i++) {
                ctx.fillStyle = `rgba(255, 255, 255, ${Math.random() * 0.4})`;
                ctx.beginPath();
                // Random small droplets
                ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, Math.random() * 2, 0, Math.PI * 2);
                ctx.fill();
            }

            // 3. Some larger "drips" or variations
            for (let i = 0; i < 200; i++) {
                ctx.fillStyle = `rgba(200, 210, 220, 0.3)`;
                ctx.beginPath();
                ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, Math.random() * 5 + 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }

        function wipe(x, y) {
            ctx.globalCompositeOperation = 'destination-out';

            // Create a "Warm Hand" gradient for the wipe brush
            const gradient = ctx.createRadialGradient(x, y, 10, x, y, 45);
            gradient.addColorStop(0, "rgba(0,0,0,1)"); // Center fully clear
            gradient.addColorStop(0.5, "rgba(0,0,0,0.5)"); // Soft edge
            gradient.addColorStop(1, "rgba(0,0,0,0)"); // Fade out

            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(x, y, 45, 0, Math.PI * 2, false);
            ctx.fill();

            if (hint.style.opacity !== '0') {
                hint.style.opacity = '0';
                hint.style.transition = 'opacity 0.8s';
            }
            wipeCount++;
            checkAutoClear();
        }

        // Mouse Events
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            const pos = getMousePos(e);
            wipe(pos.x, pos.y);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDrawing) {
                const pos = getMousePos(e);
                wipe(pos.x, pos.y);
            }
        });

        window.addEventListener('mouseup', () => {
            isDrawing = false;
        });

        // Touch Events for mobile
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); // prevent scrolling
            isDrawing = true;
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            wipe(touch.clientX - rect.left, touch.clientY - rect.top);
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (isDrawing) {
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                wipe(touch.clientX - rect.left, touch.clientY - rect.top);
            }
        }, { passive: false });

        window.addEventListener('resize', resize);

        // Init
        resize();

        // --- AUTH & CLEANUP ---
        let wipeCount = 0;
        function checkAutoClear() {
            if (wipeCount > 80) { // Approx 1.5 seconds of wiping
                canvas.style.transition = 'opacity 1s';
                canvas.style.opacity = '0';
                canvas.style.pointerEvents = 'none'; // Unblock form
            }
        }

        // --- FORM HANDLING ---
        function handleForm(e) {
            e.preventDefault();
            const form = document.getElementById('emailForm');
            const result = document.getElementById('offerResult');
            const btn = form.querySelector('button');
            btn.innerHTML = "Відправка...";

            // Google Form Data
            const FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSfMqCoTyx61dxDnNlKg41ALTi1J6gRdn1R4FGUDplm0SHCtvQ/formResponse';
            const ID_NAME = 'entry.166527665';
            const ID_CONTACT = 'entry.2146130319';

            const nameVal = form.querySelector('input[name="name"]').value;
            const contactVal = form.querySelector('input[name="contact"]').value;
            const finalName = `${nameVal} (Your last chance)`;

            const formData = new FormData();
            formData.append(ID_NAME, finalName);
            formData.append(ID_CONTACT, contactVal);

            fetch(FORM_URL, { method: 'POST', body: formData, mode: 'no-cors' })
                .then(() => {
                    form.style.display = 'none';
                    result.classList.add('visible');
                })
                .catch(() => {
                    form.style.display = 'none';
                    result.classList.add('visible');
                });
        }
    </script>
</body>

</html>